-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Workspace = game:GetService("Workspace")

-- ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "UltimateFramework"
gui.Parent = PlayerGui
gui.ResetOnSpawn = false

-- Key System
local validKeys = {"Joel","Sami"}
local usedKeys = {}

-- Rainbow Key GUI
local keyFrame = Instance.new("Frame", gui)
keyFrame.Size = UDim2.new(0.35,0,0.25,0)
keyFrame.Position = UDim2.new(0.325,0,0.35,0)
keyFrame.BackgroundColor3 = Color3.fromRGB(255,0,0)
keyFrame.Active = true
keyFrame.Draggable = true
Instance.new("UICorner", keyFrame).CornerRadius = UDim.new(0,20)

local keyBox = Instance.new("TextBox", keyFrame)
keyBox.Size = UDim2.new(0.7,0,0.3,0)
keyBox.Position = UDim2.new(0.15,0,0.2,0)
keyBox.PlaceholderText = "Enter Key"
keyBox.TextScaled = true
keyBox.Font = Enum.Font.GothamBold
keyBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
keyBox.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", keyBox).CornerRadius = UDim.new(0,12)

local submitBtn = Instance.new("TextButton", keyFrame)
submitBtn.Size = UDim2.new(0.5,0,0.25,0)
submitBtn.Position = UDim2.new(0.25,0,0.6,0)
submitBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
submitBtn.Text = "Submit"
submitBtn.TextScaled = true
submitBtn.Font = Enum.Font.GothamBold
submitBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", submitBtn).CornerRadius = UDim.new(0,12)

-- Main GUI Frame
local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0.7,0,0.7,0)
mainFrame.Position = UDim2.new(0.15,0,0.15,0)
mainFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
mainFrame.Visible = false
mainFrame.Active = true
mainFrame.Draggable = true
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0,20)

-- GUI Controls
local closeBtn = Instance.new("TextButton", mainFrame)
closeBtn.Size = UDim2.new(0.05,0,0.08,0)
closeBtn.Position = UDim2.new(0.95,-10,0,5)
closeBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
closeBtn.Text = "X"
closeBtn.TextScaled = true
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0,10)

local minimizeBtn = Instance.new("TextButton", mainFrame)
minimizeBtn.Size = UDim2.new(0.05,0,0.08,0)
minimizeBtn.Position = UDim2.new(0.88,-10,0,5)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
minimizeBtn.Text = "_"
minimizeBtn.TextScaled = true
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", minimizeBtn).CornerRadius = UDim.new(0,10)

local fullscreenBtn = Instance.new("TextButton", mainFrame)
fullscreenBtn.Size = UDim2.new(0.05,0,0.08,0)
fullscreenBtn.Position = UDim2.new(0.81,-10,0,5)
fullscreenBtn.BackgroundColor3 = Color3.fromRGB(50,150,50)
fullscreenBtn.Text = "[ ]"
fullscreenBtn.TextScaled = true
fullscreenBtn.Font = Enum.Font.GothamBold
fullscreenBtn.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", fullscreenBtn).CornerRadius = UDim.new(0,10)

closeBtn.MouseButton1Click:Connect(function() gui:Destroy() end)
minimizeBtn.MouseButton1Click:Connect(function() mainFrame.Visible = false end)
fullscreenBtn.MouseButton1Click:Connect(function() mainFrame.Size = UDim2.new(1,0,1,0); mainFrame.Position = UDim2.new(0,0,0,0) end)

-- Tabs
local buttonFrame = Instance.new("Frame", mainFrame)
buttonFrame.Size = UDim2.new(0.22,0,1,0)
buttonFrame.Position = UDim2.new(0,0,0,0)
buttonFrame.BackgroundTransparency = 1

local tabFrames = {}
local activeTab = nil
local tabs = {"Main","Other","ESP","Settings"}

for i,name in ipairs(tabs) do
    local tabBtn = Instance.new("TextButton", buttonFrame)
    tabBtn.Size = UDim2.new(0.9,0,0.18,0)
    tabBtn.Position = UDim2.new(0.05,0,0.05 + (i-1)*0.22,0)
    tabBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    tabBtn.Text = name
    tabBtn.TextScaled = true
    tabBtn.Font = Enum.Font.GothamBold
    tabBtn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", tabBtn).CornerRadius = UDim.new(0,10)
    
    local content = Instance.new("Frame", mainFrame)
    content.Size = UDim2.new(0.75,0,0.9,0)
    content.Position = UDim2.new(0.23,0,0.05,0)
    content.BackgroundColor3 = Color3.fromRGB(25,25,25)
    content.BorderSizePixel = 0
    content.Visible = false
    Instance.new("UICorner", content).CornerRadius = UDim.new(0,12)
    tabFrames[name] = content
    
    tabBtn.MouseButton1Click:Connect(function()
        if activeTab then tabFrames[activeTab].Visible = false end
        content.Visible = true
        activeTab = name
    end)
end

-- Key Verification
submitBtn.MouseButton1Click:Connect(function()
    local key = keyBox.Text
    if table.find(validKeys,key) and not table.find(usedKeys,key) then
        table.insert(usedKeys,key)
        keyFrame.Visible = false
        mainFrame.Visible = true
    else
        keyBox.Text = "Invalid Key"
    end
end)

-- Rainbow Animation
task.spawn(function()
    while true do
        for hue=0,1,0.01 do
            keyFrame.BackgroundColor3 = Color3.fromHSV(hue,1,1)
            task.wait(0.05)
        end
    end
end)

-- Toggle function
local function makeToggle(parent,text,pos,callback)
    local btn = Instance.new("TextButton", parent)
    btn.Size = UDim2.new(0.6,0,0.12,0)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
    btn.Text = text.." OFF"
    btn.TextScaled = true
    btn.Font = Enum.Font.GothamBold
    btn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,10)
    local state = false
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = text.." "..(state and "ON" or "OFF")
        callback(state)
    end)
end

-- Example features
local fly, noclip = false,false
makeToggle(tabFrames["Main"],"Fly",UDim2.new(0.2,0,0.1,0),function(state) fly = state end)
makeToggle(tabFrames["Main"],"Noclip",UDim2.new(0.2,0,0.25,0),function(state) noclip = state end)

-- ESP Tab
local espEnabled = false
local espFolder = Instance.new("Folder", gui)
espFolder.Name = "ESP_Highlights"
makeToggle(tabFrames["ESP"],"ESP",UDim2.new(0.2,0,0.1,0),function(state) espEnabled = state end)

-- RunService Loop
RunService.Heartbeat:Connect(function()
    if fly and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame =
